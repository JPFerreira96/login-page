<div class="layout">
  <!-- Sidebar simples -->
  <aside class="sidebar">
    <div class="brand">UrbanPass</div>
    <nav>
      <a class="item active">Meus cartões</a>
      <a class="item">Meus dados</a>
      <a class="item">Minhas solicitações</a>
      <a class="item">Compra de crédito</a>
      <a class="item">Sair</a>
    </nav>
  </aside>

  <!-- Conteúdo -->
  <main class="content">
    <header class="topbar">
      <h1 class="title">Meus cartões</h1>
      <!-- <div class="actions">
        <button class="btn ghost">Vincular VEM Comum +</button>
      </div> -->
    </header>

    <section class="cards-area">
      <div class="info-row">
        <span class="dot dot--blue"></span>
        <span class="dot dot--gray"></span>
      </div>

      <!-- loading / erro -->
      <div *ngIf="loading()" class="skeleton">Carregando…</div>
      <div *ngIf="!loading() && error()" class="error">{{ error() }}</div>

      <!-- Se tem cartões, mostra o slider centralizado -->
      <div *ngIf="!loading() && !error() && cards().length > 0" class="slider-container">
        <div class="slider">
          <div class="slider__track"
               [style.transform]="'translateX(' + (-index()*100) + '%)'">
            <div class="slider__slide" *ngFor="let c of cards()">
              <div class="card" [ngClass]="colorClass(c)">
                <div class="card__header">
                  <div class="card__brand">UrbanPass</div>
                  <div class="card__type">{{ c.type | titlecase }}</div>
                </div>

                <div class="card__number">
                  {{ c.numeroCartao || c.serial || 'Nº não informado' }}
                  <!-- DEBUG: {{ c.numeroCartao }} | {{ c.serial }} | {{ c.id }} -->
                </div>

                <div class="card__balance-section">
                  <div class="balance-row">
                    <small>Seu saldo</small>
                    <button class="eye-btn" (click)="showBalance.set(!showBalance())"
                            [attr.aria-label]="showBalance() ? 'Ocultar saldo':'Mostrar saldo'">
                      <i [class]="showBalance() ? 'fas fa-eye' : 'fas fa-eye-slash'"></i>
                    </button>
                  </div>
                  <div class="balance">{{ maskedBalance(c) }}</div>
                </div>

                <div class="card__footer">
                  <span class="status-pill" [class.active]="c.status==='ATIVO'">
                    <i class="fas fa-circle"></i>
                    {{ c.status }}
                  </span>
                  <span class="card-id">ID: {{ c.id.substring(0, 8) }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- nav -->
        <div class="slider__nav">
          <button class="nav-btn" (click)="prev()">‹</button>
          <button class="nav-btn" (click)="next()">›</button>
        </div>

        <div class="slider__dots">
          <button class="dot"
                  *ngFor="let _ of cards(); let i = index"
                  [class.active]="i===index()"
                  (click)="index.set(i)"></button>
        </div>
      </div>

      <!-- Se não tem cartões, mostra opção de solicitar -->
      <div *ngIf="!loading() && !error() && cards().length === 0" class="empty-state">
        <div *ngIf="!showRequestForm()" class="no-cards">
          <h3>Você ainda não possui cartões</h3>
          <p>Solicite seu primeiro cartão de transporte para começar a utilizar o sistema UrbanPass.</p>
          <button class="btn primary" (click)="showCardRequestForm()">
            Solicitar Cartão
          </button>
        </div>

        <!-- Formulário de solicitação -->
        <div *ngIf="showRequestForm()" class="request-form">
          <h3>Solicitar Novo Cartão</h3>
          <form [formGroup]="requestForm" (ngSubmit)="requestCard()">
            <div class="field">
              <label for="cardType">Tipo de Cartão:</label>
              <select id="cardType" formControlName="cardType" class="input">
                <option value="">Selecione o tipo</option>
                <option value="COMUM">Comum</option>
                <option value="ESTUDANTE">Estudantil</option>
                <option value="TRABALHADOR">Trabalhador</option>
              </select>
            </div>

            <div class="form-actions">
              <button type="button" class="btn ghost" (click)="hideCardRequestForm()"
                      [disabled]="requestingCard()">
                Cancelar
              </button>
              <button type="submit" class="btn primary" 
                      [disabled]="!requestForm.valid || requestingCard()">
                {{ requestingCard() ? 'Solicitando...' : 'Solicitar Cartão' }}
              </button>
            </div>
          </form>
        </div>
      </div>

      <p class="note">
        <strong>Obs:</strong> Sua carteira de estudante tem validade. Se não
        for atualizada antes do vencimento, não será possível recarregar.
      </p>
    </section>

    <section class="services">
      <h2>Serviços do cartão</h2>
      <div class="grid">
        <button class="svc">Compra de Crédito</button>
        <button class="svc">Bloquear</button>
        <button class="svc">Atualização de Carteira</button>
      </div>
    </section>
  </main>
</div>
